---
import DarkLightController from "./DarkLightController.astro";
import SocialIcons from "./SocialIcons.astro";
import { template } from "@/settings";
---

<nav
  class="w-full mx-auto px-5 max-w-screen-lg flex items-center justify-between py-4 bg-base-100 sticky top-0 z-50"
>
  <div class="flex w-full items-center justify-between gap-8">
    <!-- Mobile Hamburger -->
    <button
      id="menu-toggle"
      class="md:hidden flex items-center px-2 py-1 rounded transition-colors hover:bg-secondary/20"
      aria-label="Toggle menu"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex space-x-8 items-center">
      <li>
        <a
          href={`${template.base}/`}
          class="text-lg px-3 py-1 rounded-full transition-colors hover:bg-secondary/20"
          >Home</a
        >
      </li>
      <li>
        <a
          href={`${template.base}/projects`}
          class="text-lg px-3 py-1 rounded-full transition-colors hover:bg-secondary/20"
          >Projects</a
        >
      </li>
      <li>
        <a
          href={`${template.base}/resume`}
          class="text-lg px-3 py-1 rounded-full transition-colors hover:bg-secondary/20"
          >Resume</a
        >
      </li>
    </ul>

    <div class="flex items-center gap-6">
      <SocialIcons />
      <DarkLightController />
    </div>
  </div>

  <!-- Mobile Menu -->
  <ul
    id="mobile-menu"
    class="hidden md:hidden flex-col space-y-2 mt-2 bg-base-100 rounded shadow-lg absolute left-0 right-0 top-full px-5 py-4 z-40
           opacity-0 scale-y-95 transform origin-top transition-all duration-200 ease-out"
  >
    <li>
      <a
        href={`${template.base}/`}
        class="text-lg px-3 py-1 rounded-full transition-colors hover:bg-secondary/20 block"
        >Home</a
      >
    </li>
    <li>
      <a
        href={`${template.base}/projects`}
        class="text-lg px-3 py-1 rounded-full transition-colors hover:bg-secondary/20 block"
        >Projects</a
      >
    </li>
    <li>
      <a
        href={`${template.base}/resume`}
        class="text-lg px-3 py-1 rounded-full transition-colors hover:bg-secondary/20 block"
        >Resume</a
      >
    </li>
  </ul>

  <script is:inline>
    const btn = document.getElementById("menu-toggle");
    const menu = document.getElementById("mobile-menu");

    function openMenu() {
      menu.classList.remove("hidden");
      requestAnimationFrame(() => {
        menu.classList.add("flex");
        menu.classList.remove("opacity-0", "scale-y-95");
        menu.classList.add("opacity-100", "scale-y-100");
      });
    }

    function closeMenu() {
      menu.classList.remove("opacity-100", "scale-y-100");
      menu.classList.add("opacity-0", "scale-y-95");

      // wait for animation to finish before hiding
      setTimeout(() => {
        menu.classList.remove("flex");
        menu.classList.add("hidden");
      }, 200); // match duration-200
    }

    function isMenuOpen() {
      return (
        menu.classList.contains("flex") &&
        menu.classList.contains("opacity-100")
      );
    }

    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      if (isMenuOpen()) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Close when clicking outside
    document.addEventListener("click", (e) => {
      if (isMenuOpen() && !menu.contains(e.target) && !btn.contains(e.target)) {
        closeMenu();
      }
    });

    // Close when clicking a link inside the menu
    menu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        closeMenu();
      });
    });
  </script>
</nav>
